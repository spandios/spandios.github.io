---
layout: post
title: 동시성에서 발생할 수 있는 문제들
date: 2024-04-11 10:43 +0900
img_path: /assets/images/
category: [concurrency]
tags: [ Concurrency]
---

동시성을 구현하면서 발생할 수 있는 문제는 크게 경쟁 조건과 교착 상태가 있다. 


# 경쟁 조건 (Race Condition)
경쟁 조건이란 두 개 이상의 스레드가 공유 자원에 접근해 동시에 데이터를 변경하려고 할 때 발생하는 문제를 뜻한다.

만약 두 개 이상의 스레드가 같은 데이터를 거의 동시에 변경한다고하면, 어떤 스레드가 먼저 데이터를 변경하느냐에 따라 결과가 달라질 수 있다.

예를들어, 쇼핑몰에서 비전 프로 10개를 선착순으로 5만원에 살 수 있는 이벤트가 있다고 가정해보자.

이벤트가 시작되자마자 엄청난 트래픽이 몰려 10개의 비전 프로가 동시에 판매되었다.

이때, 10개의 비전 프로를 동시에 구매하려는 스레드가 10개 이상이라면 재고 값이 어떻게 될까?

마지막 남은 비전 프로를 구매하려는 2명의 고객이 거의 동시에 주문을 한다면 두 고객은 분명 재고가 1개인 상태이기 때문에 주문을 할 수 있었고 완료가 된다.

하지만 실제로는 한명만 구매가 가능해야하는데, 두 고객이 동시에 구매를 하게되어 재고가 -1개가 되어버린다. 

더 큰 문제는 둘 중 조금이라도 늦게 신청한 고객에겐 시스템 오류로 주문을 취소 해야한다고 연락해야 하고 큰 실망을 안겨주게 된다.

# 교착 상태 (Deadlock)

만약 두 개 이상의 작업이 실행되고 있을 때 각각의 작업이 수행을 위해서는 다른 작업이 보유한 리소스가 필요한 상황이다.

이 때 서로가 자신이 보유한 리소스를 계속 유지한채, 상대방이 먼저 보유한 리소스를 놓아주기를 계속 기다리는 상태가 발생하는데 이를 교착 상태라고 한다.

예를들어, A와 B라는 스레드가 실행될 때 각자 특정 리소스를 가지고 있다. 

이 때 A가 다음 작업에 B가 먼저 보유한 리소스를 사용해야하고, B도 A가 미리 보유한 리소스를 사용해야 다음 작업을 수행할 수 있다고 가정해보자.

만약 서로가 먼저 보유한 리소스를 양보해주지 않는다면, 두 스레드는 계속해서 상대방이 먼저 보유한 리소스를 놓아주기를 기다리게 되어 무한정 대기하게 된다.




## 마치며
동시성을 구현하면서 발생할 수 있는 경쟁 조건과 교착 상태에 대해 알아보았다. 

경쟁 조건은 두 개 이상의 스레드가 공유 자원에 접근해 동시에 데이터를 변경하려고 할 때 발생하는 문제를 뜻한다. 

교착 상태는 두 개 이상의 프로세스가 서로 상대방의 작업이 끝나기만을 기다리고 있어 무한정 대기하는 상태를 말한다.

다음은 글은 경쟁 조건을 해결하는 방법에 대해 알아본다.






